CREATE TABLE STUDY_SECURITY_LEVEL
(
  STUDY          VARCHAR2(15)              NOT NULL,
  ACCESS_METHOD  VARCHAR2(10)              NOT NULL,
  CREATE_USER    VARCHAR2(30),
  CREATE_DATE    DATE,
  MODIFY_USER    VARCHAR2(30),
  MODIFY_DATE    DATE
)
/

CREATE UNIQUE INDEX SSL_PK ON STUDY_SECURITY_LEVEL
(STUDY)
/


CREATE OR REPLACE TRIGGER SSL_BU 
 BEFORE UPDATE 
 ON STUDY_SECURITY_LEVEL 
 REFERENCING OLD AS OLD NEW AS NEW 
 FOR EACH ROW 
-- PL/SQL Block
BEGIN 
 IF (:new.ACCESS_METHOD <> 'PUBLIC' and :new.ACCESS_METHOD <> 'PRIVATE') THEN 
       raise_application_error(-20001, 
           'Warning on Insert: ACCESS_METHOD must be either "PUBLIC" or "PRIVATE".'); 
 END IF; 
 :new.MODIFY_USER := substr(user,1,30); 
 :new.MODIFY_DATE := sysdate; 
END;
/


CREATE OR REPLACE TRIGGER SSL_BI 
 BEFORE INSERT 
 ON STUDY_SECURITY_LEVEL 
 REFERENCING OLD AS OLD NEW AS NEW 
 FOR EACH ROW 
-- PL/SQL Block
BEGIN 
 IF (:new.ACCESS_METHOD <> 'PUBLIC'  and :new.ACCESS_METHOD <> 'PRIVATE') THEN 
       raise_application_error(-20001, 
           'Warning on Insert: ACCESS_METHOD must be either "PUBLIC" or "PRIVATE".'); 
 END IF; 
 if :new.CREATE_USER IS NULL THEN 
   :new.CREATE_USER := substr(user,1,30); 
 END IF; 
 :new.CREATE_DATE := sysdate; 
END;
/


INSERT INTO STUDY_SECURITY_LEVEL ( STUDY, ACCESS_METHOD ) 
VALUES ( 'ALL', 'PRIVATE')
/

INSERT INTO STUDY_SECURITY_LEVEL ( STUDY, ACCESS_METHOD ) 
VALUES ( 'SMOKE_TEST', 'PUBLIC')
/