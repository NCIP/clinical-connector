CREATE TABLE STUDY_CDES_CTL
(
  STUDY           VARCHAR2(100)            NOT NULL,
  REFERENCE_CODE  VARCHAR2(100)            NOT NULL,
  CDE             VARCHAR2(400)            NOT NULL,
  CREATE_USER     VARCHAR2(30),
  CREATE_DATE     DATE,
  MODIFY_USER     VARCHAR2(30),
  MODIFY_DATE     DATE
)
/

CREATE INDEX SCC_INDX ON STUDY_CDES_CTL
(STUDY, REFERENCE_CODE)
LOGGING
NOPARALLEL
/


CREATE OR REPLACE TRIGGER SCC_BU 
 BEFORE UPDATE 
 ON STUDY_CDES_CTL 
 REFERENCING OLD AS OLD NEW AS NEW 
 FOR EACH ROW 
-- PL/SQL Block
BEGIN 
 :new.MODIFY_USER := substr(user,1,30); 
 :new.MODIFY_DATE := sysdate; 
END;
/


CREATE OR REPLACE TRIGGER SCC_BI 
 BEFORE INSERT 
 ON STUDY_CDES_CTL 
 REFERENCING OLD AS OLD NEW AS NEW 
 FOR EACH ROW 
-- PL/SQL Block
BEGIN 
 if :new.CREATE_USER IS NULL THEN 
   :new.CREATE_USER := substr(user,1,30); 
 END IF; 
 :new.CREATE_DATE := sysdate; 
END;
/


INSERT INTO STUDY_CDES_CTL ( STUDY, REFERENCE_CODE, CDE ) 
VALUES ( 'SMOKE_TEST', 'PATIENT_ID_CDE', 'CDE_ID:2003301VERSION:3.0')
/

INSERT INTO STUDY_CDES_CTL ( STUDY, REFERENCE_CODE, CDE ) 
VALUES ( 'SMOKE_TEST', 'NCI_INST_CD_CDE', 'CDE_ID:2003707VERSION:3')
/

INSERT INTO STUDY_CDES_CTL ( STUDY, REFERENCE_CODE, CDE ) 
VALUES ( 'SMOKE_TEST', 'PT_INITS', 'CDE_ID:2001039VERSION:4.0')
/

INSERT INTO STUDY_CDES_CTL ( STUDY, REFERENCE_CODE, CDE ) 
VALUES ( 'SMOKE_TEST', 'PT_DOB', 'CDE_ID:793VERSION:4.0')
/

INSERT INTO STUDY_CDES_CTL ( STUDY, REFERENCE_CODE, CDE ) 
VALUES ( 'SMOKE_TEST', 'PT_GENDER', 'CDE_ID:62VERSION:6.0')
/

INSERT INTO STUDY_CDES_CTL ( STUDY, REFERENCE_CODE, CDE ) 
VALUES ( 'SMOKE_TEST', 'REG_DATE', 'CDE_ID:2171VERSION:4.0')
/
